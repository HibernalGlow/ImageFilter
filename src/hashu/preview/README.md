# pHash 图片相似度分析工具

一个基于 Streamlit 的交互式图片相似度分析工具，使用感知哈希(pHash)算法检测相似和重复图片。

## 🚀 功能特点

- **多尺寸分析**: 支持同时分析多个哈希尺寸(4-64)，比较不同精度下的效果
- **交互式界面**: 美观的 Streamlit Web 界面，实时进度显示
- **智能预设**: 提供快速测试、标准分析、精细分析等多种预设组合
- **结果可视化**: 丰富的图表展示，包括距离分布、性能对比等
- **疑似重复检测**: 自动识别高相似度图片，支持自定义阈值
- **多格式导出**: 支持 JSON 和 Excel 两种格式导出结果
- **数据持久化**: 结果保存后可重复加载和分析

## 📋 支持的图片格式

- JPEG (.jpg, .jpeg)
- PNG (.png)
- WebP (.webp)
- BMP (.bmp)
- GIF (.gif)
- TIFF (.tiff)
- JPEG XL (.jxl)
- AVIF (.avif)

## 🛠️ 安装和使用

### 方法一：直接运行(推荐)

1. 双击 `start.bat` 文件
2. 等待依赖安装完成
3. 浏览器会自动打开 Web 界面

### 方法二：Python 命令行

```bash
# 安装依赖
pip install streamlit pillow pillow-avif pillow-jxl imagehash pandas plotly openpyxl

# 启动应用
streamlit run streamlit_app.py
```

### 方法三：使用启动脚本

```bash
python run_streamlit.py
```

## 📖 使用说明

### 新建分析

1. **选择模式**: 在侧边栏选择"新建分析"
2. **设置路径**: 输入包含图片的文件夹路径
3. **选择尺寸**: 
   - 使用预设组合（推荐）
   - 或自定义选择哈希尺寸
4. **高级设置**: 
   - 设置疑似重复阈值
   - 选择导出格式
5. **开始分析**: 点击"开始分析"按钮

### 加载已有结果

1. **选择模式**: 在侧边栏选择"加载已有结果"
2. **上传文件**: 选择之前保存的 JSON 结果文件
3. **查看结果**: 自动加载并显示分析结果

## 📊 结果解读

### 哈希尺寸选择指南

| 尺寸 | 特点 | 适用场景 |
|------|------|----------|
| 8-10 | 计算快，精度较低 | 快速筛选，大批量处理 |
| 12-16 | 平衡性能和精度 | 日常使用，推荐 |
| 20-24 | 精度高，计算慢 | 精细分析，小批量 |
| 32+ | 极高精度，很慢 | 特殊需求，科研用途 |

### 汉明距离含义

| 距离范围 | 相似程度 | 说明 |
|----------|----------|------|
| 0-5 | 极高 | 可能是相同图片或轻微修改 |
| 6-15 | 高 | 内容相似，可能是不同版本 |
| 16-25 | 中等 | 有一定相似性 |
| 26+ | 低 | 基本不相似 |

## 🎯 应用场景

### 重复图片清理
- 设置低阈值（≤5）检测完全重复
- 查看疑似重复报告
- 根据文件大小选择保留版本

### 相似图片分组
- 设置中等阈值（≤15）查找相似图片
- 按距离排序查看结果
- 导出Excel进行进一步处理

### 图片库整理
- 使用标准分析预设
- 导出完整报告
- 建立图片相似度索引

## 📁 输出文件说明

### JSON 格式
```json
{
  "timestamp": "分析时间",
  "total_images": "图片总数",
  "image_files": ["图片文件列表"],
  "results": {
    "哈希尺寸": {
      "hashes": "图片哈希值",
      "pairs": "图片对比结果",
      "elapsed_time": "计算耗时",
      "statistics": "统计信息"
    }
  }
}
```

### Excel 格式
- **总体统计**: 各尺寸性能对比
- **尺寸X**: 每个尺寸的详细对比结果

## ⚙️ 配置文件

`config.json` 文件可以自定义：
- 默认文件夹路径
- 哈希尺寸预设
- 相似度阈值
- UI 颜色主题
- 支持的图片格式

## 🔧 故障排除

### 常见问题

**Q: 无法识别某些图片格式？**
A: 确保安装了 pillow-avif 和 pillow-jxl 插件

**Q: 计算时间太长？**
A: 尝试使用较小的哈希尺寸或减少图片数量

**Q: 内存不足？**
A: 分批处理图片或关闭图片预览功能

**Q: 浏览器无法访问？**
A: 检查防火墙设置，或手动访问 http://localhost:8501

### 性能优化建议

1. **大量图片**: 先用小尺寸(8-10)快速筛选
2. **精确分析**: 对筛选结果用大尺寸(16-24)精确分析
3. **内存限制**: 关闭图片预览，使用表格模式
4. **网络部署**: 修改 run_streamlit.py 中的地址和端口

## 📞 技术支持

如有问题或建议，请查看：
- 控制台错误信息
- Streamlit 官方文档
- Python PIL/Pillow 文档

---

**注意**: 此工具仅用于图片相似度分析，不会修改或删除原始图片文件。
